<!DOCTYPE html>
<html>

  <head>
    <meta charset="UTF-8">
    <title>2 - JS Behind The Scenes</title>
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css"
      integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet"
      type="text/css">
    <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
    <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
      
    <link rel="stylesheet" href="item_style.css">
  
    <script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
  
  </head>
  
  <body class="vscode-light">
  <h1 id="3-how-javascript-works-behind-the-scenes">2 How JavaScript Works Behind The Scenes</h1>
  <p><a href="javascript:history.back()">go back</a> |</p>
  <ul>
    <li><a href="#3-how-javascript-works-behind-the-scenes">2 How JavaScript Works Behind The Scenes</a>
      <ul>
        <li><a href="#31-what-happens-when-javascript-is-run">2.1 What happens when JavaScript is run</a></li>
        <li><a href="#32-execution-context">2.2 Execution context</a></li>
        <li><a href="#33-what-about-the-code-within-functions">2.3 What about the code within functions</a></li>
        <li><a href="#34-the-execution-context-in-detail">2.4 The Execution context in detail</a></li>
        <li><a href="#35-hoisting">2.5 Hoisting</a>
          <ul>
            <li><a href="#hoisting-in-practice">Hoisting in practice</a></li>
            <li><a href="#function-hoisting">Function hoisting</a></li>
            <li><a href="#the-difference-in-function-expressions">The difference in function expressions</a></li>
            <li><a href="#variable-hoisting">Variable hoisting</a></li>
            <li><a href="#order-of-variable-execution">Order of variable execution</a></li>
            <li><a href="#most-important-about-hoisting">Most important about hoisting</a></li>
          </ul>
        </li>
        <li><a href="#36-scoping-and-the-scope-chain">2.6 Scoping and the scope chain</a></li>
      </ul>
    </li>
  </ul>
  <h2 id="31-what-happens-when-javascript-is-run">2.1 What happens when JavaScript is run</h2>
  <p>JavaScript is always hosted in somekind of environment, usually a browser like chrome, firefox, safari, etc.</p>
  <p>There are also environments like Node.JS web servers than can run JavaScript.</p>
  <p>Taking a look at the browser, within the browser is a JavaScript engine: a program that executes JS code. There are
    different many engines used in different browsers.</p>
  <p>The code is inserted into a parser, which validates the code and if accepted converts it into the <em>abstract
      syntax tree</em>, where the code is converted into <em>machine code</em>. This machine code is what the system is
    able to run.</p>
  <p><img src="images/Slide4.png" alt="How JS Runs"></p>
  <h2 id="32-execution-context">2.2 Execution context</h2>
  <p>All JS code must be ran in an environment, called an <em>execution context</em>. Imagined like a box, the execution
    contexts store variables from which code is evaluated and executed.</p>
  <p>The default is the <em>Global Execution Context</em>. All code outside of a function is executed. It is for
    variables and functions outside of a function. They can also be seen as objects, as the GEC is automatically
    attached to the window object of the browser.</p>
  <p>A variable <code>lastName</code> in the global context will by default be attached to the window object as
    <code>lastName === window.lastName //true</code>.</p>
  <p><img src="images/Slide5.png" alt="Execution context"></p>
  <h2 id="33-what-about-the-code-within-functions">2.3 What about the code within functions</h2>
  <p>It's simple: each new called function receives its <em>own</em> Execution Context. The new context is placed ontop
    of the GEC, creating an <em>Execution Stack</em>.</p>
  <p><img src="images/Slide6.png" alt="Execution stack a"></p>
  <p><img src="images/Slide7.png" alt="Execution stack b"></p>
  <p>Each newly called function is placed on top of the Execution Stack. Once a function has done all its work and
    returns any variables, <em>the function returns</em> and is removed from the top of the stack, making the next
    topmost function the <em>active function</em>.</p>
  <h2 id="34-the-execution-context-in-detail">2.4 The Execution context in detail</h2>
  <p>Within the GEC is the <em>Execution Context Object</em>, which has three properties:</p>
  <ol>
    <li><strong>Variable Object (VO)</strong>
      <ol>
        <li>function argument</li>
        <li>inter-variable declarations</li>
        <li>function declarations</li>
      </ol>
    </li>
    <li><strong>Scope chain</strong>
      <ol>
        <li>current variable objects</li>
        <li>variable objects of all parents</li>
      </ol>
    </li>
    <li>&quot;This&quot; variable</li>
  </ol>
  <p>When a new function is called its placed on top of the execution stack, done in <em>two phases</em>:</p>
  <ol>
    <li>Creation phase
      <ol>
        <li>Creation of the Variable Object</li>
        <li>Creation of the scope chain</li>
        <li>Determine value of the 'this' variable</li>
      </ol>
    </li>
    <li>Execution phase
      <ol>
        <li>The code of the function that generated the cureent execution context is ran line by line.</li>
      </ol>
    </li>
  </ol>
  <hr>
  <h2 id="35-hoisting">2.5 Hoisting</h2>
  <p>Within the VO, functions and variables are scanned and made available. This is called <em>hoisting</em>.</p>
  <p>The different ways functions and variables ared hoisted, is that variables are set to undefined, while functions
    will be defined.</p>
  <p><img src="images/Slide8.png" alt="Hoisting"></p>
  <h3 id="hoisting-in-practice">Hoisting in practice</h3>
  <h3 id="function-hoisting">Function hoisting</h3>
  <pre><code>The function `calculateAge()` can be placed and called after the function declaration.
</code></pre>
  <pre><code class="language-js"><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calculateAge</span>(<span class="hljs-params">year</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-number">2020</span> - year);
}

calculateAge(<span class="hljs-number">1990</span>);
</div></code></pre>
  <p>However, the function can also be called <em>before</em> the function declaration, as shown below.</p>
  <pre><code class="language-js"><div>calculateAge(<span class="hljs-number">1990</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calculateAge</span>(<span class="hljs-params">year</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-number">2020</span> - year);
}
</div></code></pre>
  <p>They will both run the same way, because all functions are already made available in a previous stage.</p>
  <h3 id="the-difference-in-function-expressions">The difference in function expressions</h3>
  <p>What happens if we apply the same code layout to a function expression like <code>var retirement =
      function(year)</code>?</p>
  <p>The below code works as expected and returns the correct value to the console log.</p>
  <pre><code class="language-js"><div><span class="hljs-keyword">var</span> retirement = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">year</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-number">65</span> - (<span class="hljs-number">2020</span> - year));
}

retirement(<span class="hljs-number">1990</span>);
</div></code></pre>
  <p>However, when calling the function before the function expression is declared the console will log an error.</p>
  <pre><code class="language-js"><div>retirement(<span class="hljs-number">1990</span>);

<span class="hljs-keyword">var</span> retirement = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">year</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-number">65</span> - (<span class="hljs-number">2020</span> - year));
}
</div></code></pre>
  <blockquote>
    <p>returns: <em>Uncaught TypeError: retirement is not a function
        at script.js:11</em></p>
  </blockquote>
  <h3 id="variable-hoisting">Variable hoisting</h3>
  <p>When trying to use a variable <em>before</em> declaring it:</p>
  <pre><code class="language-js"><div><span class="hljs-built_in">console</span>.log(age);

<span class="hljs-keyword">var</span> age = <span class="hljs-number">23</span>;
</div></code></pre>
  <blockquote>
    <p>returns: <em>undefined</em></p>
  </blockquote>
  <p>This happens because all variables are scanned and set to <em>undefined</em> on the first pass-thru.</p>
  <p>Calling an <em>undeclared</em> value will return an error.</p>
  <h3 id="order-of-variable-execution">Order of variable execution</h3>
  <pre><code class="language-js"><div><span class="hljs-keyword">var</span> age = <span class="hljs-number">23</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> age = <span class="hljs-number">65</span>;
    <span class="hljs-built_in">console</span>.log(age);
}
foo();
<span class="hljs-built_in">console</span>.log(age);
</div></code></pre>
  <p>The order in which the values are returned is:</p>
  <ul>
    <li>65</li>
    <li>23</li>
  </ul>
  <p>This because the variables within the GEC and the variables within the function are <em>different</em> variables.
    Each gets their own Variable Object.</p>
  <h3 id="most-important-about-hoisting">Most important about hoisting</h3>
  <blockquote>
    <p>Functions can be declared and called at any point in the code.</p>
  </blockquote>
  <hr>
  <h2 id="36-scoping-and-the-scope-chain">2.6 Scoping and the scope chain</h2>

</body>

</html>